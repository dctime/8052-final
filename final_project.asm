ORG 0000H
AJMP START
ORG 0050H

START:
PLACELEDDISPLAYMEMORY:
  MOV 020H, #01010101B
  MOV 021H, #00101010B
  MOV 022H, #01010101B
  MOV 023H, #00101010B
  MOV 024H, #01010101B
SCANLED:
INITSCAN:
  // init the led so that it will light up
  MOV P0, #00000000B // column MSB right 
  MOV P1, #00000000B // row MSB down
  MOV 027H, #020H // column data pointer
	MOV 025H, #00000001B // column light up
  MOV 026H, #00000001B // row light up
CHECKCOLUMNLIGHTUP:
  PUSH 0E0H // 0E0H: A
  MOV A, 025H
  CJNE A, #00100000B, PASSCHECKCOLUMNLIGHTUP
  POP 0E0H

  MOV 025H, #00000001B
  MOV 027H, #020H
PASSCHECKCOLUMNLIGHTUP:
CHECKROWLIGHTUP:
  PUSH 0E0H
  MOV A, 026H
  CJNE A, #10000000B, PASSCHECKROWLIGHTUP
  POP 0E0H
  // check row failed
  MOV 026H, #00000001B
  INC 027H // data pointer + 1

  PUSH 0E0H
  MOV A, 025H
  RL A
  MOV 025H, A
  POP 0E0H

  JMP CHECKCOLUMNLIGHTUP
PASSCHECKROWLIGHTUP:
LITUP:
  PUSH 00H
  PUSH 0E0H

  MOV R0, 027H
  MOV A, @R0
  ANL A, 025H
  MOV P0, A
  MOV P1, 026H

  POP 0E0H
  POP 00H
AFTERLIT:
  PUSH 0E0H

  MOV A, 026H
  RL A // row + 1
  MOV 026H, A

  POP 0E0H
	JMP CHECKROWLIGHTUP

DELAY:
	MOV R5, #010H
DELAY1:
	MOV R6, #0FFH
DELAY2:
	MOV R7, #0FFH
DELAY3:
	DJNZ R7, DELAY3
	DJNZ R6, DELAY2
	DJNZ R5, DELAY1
	RET
END
